<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="three.js"></script>
    <script src="tquery.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
</head>
<body>
<div id="container"></div>

</body>
<script>
    // <!--

    $.getJSON('http://localhost:3000/data', function(data) {
        var mat = new THREE.ParticleBasicMaterial({vertexColors : true, size : 1.75});

        var pointGeo = new THREE.Geometry();

        for (var i = 0; i < data.sys.length; i++) {
            var system = data.sys[i][0];

        console.log(data.sys[i][0]);
        pointGeo.vertices.push(new THREE.Vertex(new THREE.Vector3(system.pos.x, system.pos.y, system.pos.z)));

        pointGeo.vertices[i].angle = Math.atan2(system.pos.z, system.pos.x);
        pointGeo.vertices[i].radius = Math.sqrt(system.pos.x * system.pos.x + system.pos.z * system.pos.z);
        pointGeo.vertices[i].speed = (system.pos.z / 100) * (system.pos.x / 100);
        pointGeo.colors.push(new THREE.Color().setHSV((system.pos.x + 50) / 100, (system.pos.z + 50) / 100, (system.pos.y + 50) / 100));


    }

        var points = new THREE.ParticleSystem(pointGeo, mat);

        scatterPlot.add(points);
        renderer.render(scene, camera);
    });
    function createTextCanvas(text, color, font, size) {
        size = size || 24;
        var canvas = document.createElement('canvas');
        var ctx = canvas.getContext('2d');
        var fontStr = (size + 'px ') + ('Arial');
        ctx.font = fontStr;
        var w = ctx.measureText(text).width;
        var h = Math.ceil(size);
        canvas.width = w;
        canvas.height = h;
        ctx.font = fontStr;
        ctx.fillStyle = color || 'black';
        ctx.fillText(text, 0, Math.ceil(size * 0.8));
        return canvas;
    }

    function createText2D(text, color, font, size, segW, segH) {
        var canvas = createTextCanvas(text, color, font, size);
        var plane = new THREE.PlaneGeometry(canvas.width, canvas.height, segW, segH);
        var tex = new THREE.Texture(canvas);
        tex.needsUpdate = true;
        var planeMat = new THREE.MeshBasicMaterial({
            map : tex, color : 0xffffff, transparent : true
        });
        var mesh = new THREE.Mesh(plane, planeMat);
        mesh.scale.set(0.1, 0.1, 0.1);
        mesh.doubleSided = true;
        return mesh;
    }

    var renderer = new THREE.WebGLRenderer({antialias : true});
    var w = window.innerWidth;
    var h = window.innerHeight;
    renderer.setSize(w, h);
    document.body.appendChild(renderer.domElement);

    renderer.setClearColorHex(0xEEEEEE, 1.0);

    var camera = new THREE.PerspectiveCamera(45, w / h, 0.1, 10000);
    camera.position.z = 45;
    camera.position.x = 0;
    camera.position.y = 35;

    var scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0xFFFFFF, 0.0035);

    var scatterPlot = new THREE.Object3D();

    scene.add(scatterPlot);

    scatterPlot.rotation.y = 0.5;

    function v(x, y, z) {
        return new THREE.Vertex(new THREE.Vector3(x, y, z));
    }

    var lineGeo = new THREE.Geometry();

    lineGeo.vertices.push(
            v(0, 0, 0), v(16, 0, 0),
            v(0, 0, 0), v(0, 16, 0),
            v(0, 0, 0), v(0, 0, 16),



            v(0, 0, 0), v(16, 0, 0),
            v(0, 0, 0), v(0, 16, 0),
            v(0, 0, 0), v(0, 0, 16),

            v(0, 16, 0), v(16, 16, 0),
            v(0, 0, 0), v(16, 0, 0),
            v(0, 16, 16), v(16, 16, 16),
            v(0, 0, 16), v(16, 0, 16),

            v(0, 0, 16), v(16, 0, 16),
            v(0, 0, 0), v(16, 0, 0),
            v(0, 16, 0), v(16, 16, 0),
            v(0, 0, 0), v(16, 0, 0),

            v(16, 0, 0), v(16, 16, 0),
            v(0, 0, 0), v(0, 16, 0),
            v(16, 0, 16), v(16, 16, 16),
            v(0, 0, 16), v(0, 16, 16),

            v(0, 0, 16), v(0, 16, 16),
            v(0, 0, 0), v(0, 16, 0),
            v(16, 0, 0), v(16, 16, 0),
            v(0, 0, 0), v(0, 16, 0),

            v(16, 16, 0), v(16, 16, 16),
            v(16, 0, 0), v(16, 0, 16),
            v(0, 16, 0), v(0, 16, 16),
            v(0, 0, 0), v(0, 0, 16),

            v(0, 0, 0), v(0, 0, 16),
            v(16, 0, 0), v(16, 0, 16),
            v(0, 16, 0), v(0, 16, 16),
            v(0, 0, 0), v(0, 0, 16)
    );
    var lineMat = new THREE.LineBasicMaterial({color : 0x808080, lineWidth : 1});
    var line = new THREE.Line(lineGeo, lineMat);
    line.type = THREE.Lines;
    scatterPlot.add(line);

    var titleX = createText2D('0');
    titleX.position.z = 16;
    scatterPlot.add(titleX);





    var paused = false;
    var last = new Date().getTime();
    var down = false;
    var sx = 0, sy = 0;
    window.onmousedown = function (ev) {
        down = true;
        sx = ev.clientX;
        sy = ev.clientY;
    };
    window.onmouseup = function () {
        down = false;
    };
    window.onmousemove = function (ev) {
        if (down) {
            var dx = ev.clientX - sx;
            var dy = ev.clientY - sy;
            scatterPlot.rotation.y += dx * 0.01;
            camera.position.y += dy;
            sx += dx;
            sy += dy;
        }
    }
    var animating = false;
    window.ondblclick = function () {
        animating = !animating;
    };
    function animate(t) {
        if (!paused) {
            last = t;
            if (animating) {
                var v = pointGeo.vertices;
                for (var i = 0; i < v.length; i++) {
                    var u = v[i];
                    u.angle += u.speed * 0.01;
                    u.position.x = Math.cos(u.angle) * u.radius;
                    u.position.z = Math.sin(u.angle) * u.radius;
                }
                pointGeo.__dirtyVertices = true;
            }
            renderer.clear();
            camera.lookAt(scene.position);
            renderer.render(scene, camera);
        }
        window.requestAnimationFrame(animate, renderer.domElement);
    }
    ;
    animate(new Date().getTime());
    onmessage = function (ev) {
        paused = (ev.data == 'pause');
    };
    //-->

</script>
</html>